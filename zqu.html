<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‚‡åº†å­¦é™¢åå‹¤æœåŠ¡å·¥ä½œåº§è°ˆä¼šåé¦ˆç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", Arial, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            padding: 25px;
        }
        
        /* å¤´éƒ¨ */
        .header {
            text-align: center;
            padding: 25px 0;
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 25px;
            position: relative;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header h1 i {
            color: #ffd166;
        }
        
        .admin-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: none;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 300;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* åœ°å›¾å®¹å™¨ */
        .map-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 2px solid #e9ecef;
        }
        
        .map-container h2 {
            margin-bottom: 20px;
            color: #2a5298;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .map-wrapper {
            position: relative;
            width: 100%;
            height: 600px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #dee2e6;
            background: #f8f9fa;
        }
        
        #zqu-map {
            width: 100%;
            height: 100%;
            cursor: crosshair;
            object-fit: contain;
            display: block;
        }
        
        .map-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10;
            max-width: 250px;
        }
        
        .map-overlay h4 {
            margin-bottom: 10px;
            color: #2a5298;
        }
        
        /* æ ‡è®°åˆ—è¡¨ */
        .markers-sidebar {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            border: 2px solid #e9ecef;
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .markers-sidebar h2 {
            margin-bottom: 20px;
            color: #2a5298;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .markers-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .marker-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #2a5298;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .marker-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .marker-item.active {
            background: #e7f1ff;
            border-left-color: #ff6b6b;
        }
        
        .marker-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        
        .marker-title {
            font-weight: bold;
            color: #2a5298;
            font-size: 1.1rem;
        }
        
        .marker-location {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .marker-problem {
            color: #dc3545;
            font-size: 0.9rem;
            margin-bottom: 8px;
            padding: 5px 10px;
            background: rgba(220, 53, 69, 0.1);
            border-radius: 4px;
            display: inline-block;
        }
        
        .marker-description {
            color: #495057;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .marker-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #6c757d;
            font-size: 0.85rem;
            border-top: 1px solid #dee2e6;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .marker-type {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .type-dormitory { background: #cfe2ff; color: #084298; }
        .type-canteen { background: #d1e7dd; color: #0a3622; }
        .type-facilities { background: #fff3cd; color: #664d03; }
        .type-sanitation { background: #f8d7da; color: #842029; }
        .type-security { background: #e2e3e5; color: #41464b; }
        .type-water { background: #cff4fc; color: #055160; }
        .type-repair { background: #f8d7da; color: #842029; }
        .type-other { background: #e2e3e5; color: #41464b; }
        
        /* é—®é¢˜åˆ†ç±» */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .category-btn {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
        }
        
        .category-btn:hover {
            border-color: #2a5298;
            background: #f8f9fa;
        }
        
        .category-btn.active {
            background: #2a5298;
            color: white;
            border-color: #2a5298;
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        
        .control-panel h2 {
            margin-bottom: 20px;
            color: #2a5298;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-group label {
            font-weight: 500;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        select, input, textarea {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 25px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #198754 0%, #157347 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
            color: #212529;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        /* è¯´æ˜éƒ¨åˆ† */
        .instructions {
            background: linear-gradient(135deg, #e7f1ff 0%, #d4e4ff 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 2px solid #cfe2ff;
        }
        
        .instructions h2 {
            margin-bottom: 20px;
            color: #1e3c72;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instruction-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
        }
        
        .step {
            background: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #2a5298;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            margin: 0 auto 15px;
        }
        
        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: #6c757d;
            border-top: 2px solid #e9ecef;
            margin-top: 30px;
            background-color: #1a2b4c;
            color: #e0e0e0;
            border-radius: 8px;
        }
        
        .footer-logo {
            font-size: 1.5rem;
            color: white;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .footer-contact {
            font-size: 1rem;
            margin-top: 15px;
        }
        
        .footer-contact i {
            margin-right: 5px;
            color: #4dabf7;
        }
        
        /* å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.8rem;
            cursor: pointer;
            color: #6c757d;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-modal:hover {
            background: #f8f9fa;
            color: #333;
        }
        
        /* æ ‡è®°æ ·å¼ - æ ¹æ®ç±»å‹æ˜¾ç¤ºä¸åŒé¢œè‰² */
        .map-marker {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .map-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 20;
        }
        
        .marker-icon {
            font-size: 2rem;
            filter: drop-shadow(0 3px 5px rgba(0,0,0,0.3));
            position: relative;
        }
        
        .marker-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        /* ä¸åŒé—®é¢˜ç±»å‹çš„æ ‡è®°é¢œè‰² */
        .marker-dormitory { color: #084298; }
        .marker-canteen { color: #0a3622; }
        .marker-facilities { color: #664d03; }
        .marker-sanitation { color: #842029; }
        .marker-security { color: #41464b; }
        .marker-water { color: #055160; }
        .marker-repair { color: #842029; }
        .marker-other { color: #41464b; }
        
        /* ç®¡ç†é¢æ¿ */
        .admin-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border: 2px solid #dc3545;
        }
        
        .admin-panel h3 {
            color: #dc3545;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* è¯„è®ºé¡¹ */
        .comment-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            position: relative;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .comment-user {
            font-weight: bold;
            color: #2a5298;
        }
        
        .comment-time {
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .comment-text {
            margin-bottom: 8px;
        }
        
        .comment-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .markers-sidebar {
                height: 400px;
            }
            
            .map-wrapper {
                height: 400px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-actions {
                flex-direction: column;
            }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* PINç è¾“å…¥æ¡† */
        .pin-input {
            font-size: 1.2rem;
            letter-spacing: 5px;
            text-align: center;
            font-weight: bold;
        }
    </style>
    <!-- Font Awesome å›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1><i class="fas fa-map-marked-alt"></i> è‚‡åº†å­¦é™¢åå‹¤æœåŠ¡å·¥ä½œåº§è°ˆä¼šåé¦ˆç³»ç»Ÿ</h1>
            <div class="admin-badge" id="admin-badge">
                <i class="fas fa-user-shield"></i> ç®¡ç†å‘˜æ¨¡å¼
            </div>
            <p class="subtitle">
                æ„Ÿè°¢æ‚¨å‚ä¸æœ¬æ¬¡åå‹¤æœåŠ¡å·¥ä½œé—®å·è°ƒæŸ¥ï¼è¯·åœ¨åœ°å›¾ä¸Šæ ‡è®°é—®é¢˜ä½ç½®ï¼Œ
                è¯¦ç»†æè¿°åå‹¤æœåŠ¡å­˜åœ¨çš„é—®é¢˜ï¼Œå¸®åŠ©æˆ‘ä»¬å»ºè®¾æ›´å¥½çš„æ ¡å›­ç¯å¢ƒã€‚
            </p>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-content">
            <!-- åœ°å›¾åŒºåŸŸ -->
            <div class="map-container">
                <h2><i class="fas fa-map"></i> è‚‡åº†å­¦é™¢æ ¡å›­åœ°å›¾</h2>
                <div class="map-wrapper">
                    <div class="map-overlay">
                        <h4><i class="fas fa-info-circle"></i> ä½¿ç”¨è¯´æ˜</h4>
                        <p>ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®æ·»åŠ æ ‡è®°</p>
                        <p>ç‚¹å‡»å·²æœ‰æ ‡è®°æŸ¥çœ‹è¯¦æƒ…</p>
                        <p>æ‹–åŠ¨å›¾ç‰‡å¯æŸ¥çœ‹ä¸åŒåŒºåŸŸ</p>
                    </div>
                    <img id="zqu-map" src="zqu-map.jpg" alt="è‚‡åº†å­¦é™¢åœ°å›¾" onerror="this.src='https://via.placeholder.com/800x600?text=è¯·æ”¾ç½®è‚‡åº†å­¦é™¢åœ°å›¾å›¾ç‰‡\nå‘½åä¸ºï¼šzqu-map.jpg'">
                </div>
                
                <!-- é—®é¢˜åˆ†ç±» -->
                <div class="categories">
                    <div class="category-btn active" data-category="all">
                        <i class="fas fa-layer-group"></i> å…¨éƒ¨é—®é¢˜
                    </div>
                    <div class="category-btn" data-category="dormitory">
                        <i class="fas fa-bed"></i> å®¿èˆç®¡ç†
                    </div>
                    <div class="category-btn" data-category="canteen">
                        <i class="fas fa-utensils"></i> é£Ÿå ‚æœåŠ¡
                    </div>
                    <div class="category-btn" data-category="facilities">
                        <i class="fas fa-tools"></i> å…¬å…±è®¾æ–½
                    </div>
                    <div class="category-btn" data-category="sanitation">
                        <i class="fas fa-broom"></i> ç¯å¢ƒå«ç”Ÿ
                    </div>
                    <div class="category-btn" data-category="security">
                        <i class="fas fa-shield-alt"></i> æ ¡å›­å®‰å…¨
                    </div>
                </div>
            </div>
            
            <!-- æ ‡è®°åˆ—è¡¨ -->
            <div class="markers-sidebar">
                <h2><i class="fas fa-list"></i> é—®é¢˜åé¦ˆåˆ—è¡¨</h2>
                <div class="markers-list" id="markers-list">
                    <!-- æ ‡è®°åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    <div class="no-markers">
                        <p style="text-align: center; color: #6c757d; padding: 40px 20px;">
                            <i class="fas fa-map-pin" style="font-size: 3rem; color: #dee2e6; margin-bottom: 15px; display: block;"></i>
                            æš‚æ— åé¦ˆ<br>
                            ç‚¹å‡»åœ°å›¾æ·»åŠ ç¬¬ä¸€ä¸ªé—®é¢˜æ ‡è®°
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="control-panel">
            <h2><i class="fas fa-sliders-h"></i> åé¦ˆæ§åˆ¶</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="problem-type"><i class="fas fa-tag"></i> é—®é¢˜ç±»å‹</label>
                    <select id="problem-type">
                        <option value="dormitory">ğŸ›ï¸ å®¿èˆç®¡ç†ä¸æœåŠ¡</option>
                        <option value="canteen">ğŸ½ï¸ é£Ÿå ‚é¤é¥®æœåŠ¡</option>
                        <option value="facilities">ğŸ”§ å…¬å…±è®¾æ–½ç»´æŠ¤</option>
                        <option value="sanitation">ğŸ§¹ æ ¡å›­ç¯å¢ƒå«ç”Ÿ</option>
                        <option value="security">ğŸ›¡ï¸ æ ¡å›­å®‰å…¨ä¿éšœ</option>
                        <option value="water">ğŸ’§ æ°´ç”µä¾›åº”æœåŠ¡</option>
                        <option value="repair">ğŸ”¨ ç»´ä¿®å“åº”æ•ˆç‡</option>
                        <option value="other">ğŸ“ å…¶ä»–æ„è§å»ºè®®</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="urgency-level"><i class="fas fa-exclamation-triangle"></i> ç´§æ€¥ç¨‹åº¦</label>
                    <select id="urgency-level">
                        <option value="low">ğŸŸ¢ å»ºè®®æ”¹è¿› - éç´§æ€¥ï¼Œå¯çº³å…¥é•¿æœŸè§„åˆ’</option>
                        <option value="medium">ğŸŸ¡ éœ€è¦å…³æ³¨ - çŸ­æœŸå†…åº”è§£å†³</option>
                        <option value="high">ğŸ”´ ç´§æ€¥é—®é¢˜ - éœ€ç«‹å³å¤„ç†</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="user-department"><i class="fas fa-graduation-cap"></i> æ‚¨çš„èº«ä»½</label>
                    <select id="user-department">
                        <option value="student">ğŸ“ åœ¨æ ¡å­¦ç”Ÿ</option>
                        <option value="postgraduate">ğŸ“š ç ”ç©¶ç”Ÿ</option>
                        <option value="teacher">ğŸ‘¨â€ğŸ« ä¸“ä»»æ•™å¸ˆ</option>
                        <option value="instructor">ğŸ‘©â€ğŸ« è¾…å¯¼å‘˜</option>
                        <option value="admin">ğŸ‘¨â€ğŸ’¼ è¡Œæ”¿äººå‘˜</option>
                        <option value="worker">ğŸ‘· åå‹¤èŒå·¥</option>
                        <option value="other">ğŸ‘¤ å…¶ä»–äººå‘˜</option>
                    </select>
                </div>
            </div>
            
            <div class="buttons">
                <button id="help-btn" class="btn btn-success">
                    <i class="fas fa-question-circle"></i> ä½¿ç”¨å¸®åŠ©
                </button>
                <button id="admin-logout" class="btn btn-danger" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> é€€å‡ºç®¡ç†å‘˜
                </button>
            </div>
        </div>
        
        <!-- è¯´æ˜éƒ¨åˆ† -->
        <div class="instructions">
            <h2><i class="fas fa-comments"></i> åº§è°ˆä¼šåé¦ˆå¡«å†™æŒ‡å—</h2>
            <div class="instruction-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h4>ç²¾å‡†å®šä½</h4>
                    <p>åœ¨åœ°å›¾ä¸Šç‚¹å‡»é—®é¢˜å‘ç”Ÿçš„å…·ä½“ä½ç½®ï¼ˆå¦‚ï¼šç¬¬ä¸‰é£Ÿå ‚ã€17æ ‹å®¿èˆç­‰ï¼‰</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h4>è¯¦ç»†æè¿°</h4>
                    <p>å‡†ç¡®æè¿°é—®é¢˜ç°è±¡ã€å‘ç”Ÿé¢‘ç‡ã€å½±å“èŒƒå›´ç­‰å…·ä½“ä¿¡æ¯</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h4>è¯„ä¼°ä¼˜å…ˆçº§</h4>
                    <p>æ ¹æ®é—®é¢˜çš„ç´§æ€¥ç¨‹åº¦å’Œé‡è¦æ€§ï¼Œé€‰æ‹©åˆé€‚çš„ä¼˜å…ˆçº§</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h4>æå‡ºå»ºè®®</h4>
                    <p>å¦‚æœ‰å¯èƒ½ï¼Œæå‡ºæ‚¨çš„æ”¹è¿›å»ºè®®æˆ–è§£å†³æ–¹æ¡ˆ</p>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <div class="footer">
            <div class="footer-logo">è‚‡åº†å­¦é™¢åå‹¤ç®¡ç†å¤„</div>
            <p>åå‹¤æœåŠ¡å·¥ä½œåº§è°ˆä¼šåé¦ˆç³»ç»Ÿ &copy; 2025 è‚‡åº†å­¦é™¢</p>
            <p class="footer-contact">
                <i class="fas fa-phone"></i> åå‹¤æœåŠ¡çƒ­çº¿:19860503565 | 
                <i class="fas fa-envelope"></i> è”ç³»é‚®ç®±: zquxshqyb@163.com
            </p>
            <p style="font-size: 0.9rem; color: #adb5bd; margin-top: 10px;">
                æœ¬ç³»ç»Ÿæ”¶é›†çš„ä¿¡æ¯å°†ç”¨äºåå‹¤æœåŠ¡è´¨é‡æ”¹è¿›ï¼Œæ‰€æœ‰ä¸ªäººä¿¡æ¯å°†ä¸¥æ ¼ä¿å¯†
            </p>
        </div>
    </div>
    
    <!-- æ·»åŠ æ ‡è®°å¼¹çª— -->
    <div id="marker-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-map-pin"></i> æ·»åŠ é—®é¢˜åé¦ˆ</h2>
            
            <div class="modal-form">
                <div class="control-group" style="margin-bottom: 20px;">
                    <label for="marker-title"><i class="fas fa-heading"></i> é—®é¢˜æ ‡é¢˜</label>
                    <input type="text" id="marker-title" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸‰å­¦ç”Ÿé£Ÿå ‚æ—©é¤ä¾›åº”ä¸è¶³" maxlength="50">
                </div>
                
                <div class="control-group" style="margin-bottom: 20px;">
                    <label for="marker-description"><i class="fas fa-align-left"></i> é—®é¢˜æè¿°</label>
                    <textarea id="marker-description" rows="4" placeholder="è¯·è¯¦ç»†æè¿°é—®é¢˜æƒ…å†µï¼ŒåŒ…æ‹¬ç°è±¡ã€å½±å“èŒƒå›´ã€å‘ç”Ÿæ—¶é—´ç­‰..."></textarea>
                </div>
                
                <div class="controls-grid" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="modal-problem-type"><i class="fas fa-tag"></i> é—®é¢˜ç±»å‹</label>
                        <select id="modal-problem-type">
                            <option value="dormitory">ğŸ›ï¸ å®¿èˆç®¡ç†ä¸æœåŠ¡</option>
                            <option value="canteen">ğŸ½ï¸ é£Ÿå ‚é¤é¥®æœåŠ¡</option>
                            <option value="facilities">ğŸ”§ å…¬å…±è®¾æ–½ç»´æŠ¤</option>
                            <option value="sanitation">ğŸ§¹ æ ¡å›­ç¯å¢ƒå«ç”Ÿ</option>
                            <option value="security">ğŸ›¡ï¸ æ ¡å›­å®‰å…¨ä¿éšœ</option>
                            <option value="water">ğŸ’§ æ°´ç”µä¾›åº”æœåŠ¡</option>
                            <option value="repair">ğŸ”¨ ç»´ä¿®å“åº”æ•ˆç‡</option>
                            <option value="other">ğŸ“ å…¶ä»–æ„è§å»ºè®®</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="modal-urgency"><i class="fas fa-exclamation-triangle"></i> ç´§æ€¥ç¨‹åº¦</label>
                        <select id="modal-urgency">
                            <option value="low">ğŸŸ¢ å»ºè®®æ”¹è¿› - éç´§æ€¥ï¼Œå¯çº³å…¥é•¿æœŸè§„åˆ’</option>
                            <option value="medium">ğŸŸ¡ éœ€è¦å…³æ³¨ - çŸ­æœŸå†…åº”è§£å†³</option>
                            <option value="high">ğŸ”´ ç´§æ€¥é—®é¢˜ - éœ€ç«‹å³å¤„ç†</option>
                        </select>
                    </div>
                </div>
                
                <div class="controls-grid" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="user-name"><i class="fas fa-user"></i> æ‚¨çš„å§“åï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="user-name" placeholder="å¯é€‰ï¼Œç”¨äºåç»­è”ç³»">
                    </div>
                    
                    <div class="control-group">
                        <label for="user-contact"><i class="fas fa-phone"></i> è”ç³»æ–¹å¼ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="user-contact" placeholder="å¯é€‰ï¼Œæ‰‹æœºæˆ–é‚®ç®±">
                    </div>
                </div>
                
                <div class="control-group" style="margin-bottom: 30px;">
                    <label for="suggestion"><i class="fas fa-lightbulb"></i> æ‚¨çš„å»ºè®®ï¼ˆå¯é€‰ï¼‰</label>
                    <textarea id="suggestion" rows="3" placeholder="å¦‚æœæ‚¨æœ‰è§£å†³é—®é¢˜çš„å»ºè®®ï¼Œè¯·å¡«å†™åœ¨æ­¤..."></textarea>
                </div>
                
                <div class="buttons">
                    <button id="cancel-marker" class="btn btn-secondary">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                    <button id="save-marker" class="btn btn-primary">
                        <i class="fas fa-save"></i> ä¿å­˜åé¦ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æŸ¥çœ‹æ ‡è®°è¯¦æƒ…å¼¹çª— -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div id="detail-content">
                <!-- è¯¦æƒ…å†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- PINç éªŒè¯å¼¹çª— -->
    <div id="pin-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-lock"></i> ç®¡ç†å‘˜èº«ä»½éªŒè¯</h2>
            
            <div class="modal-form" style="text-align: center;">
                <div style="margin-bottom: 30px;">
                    <i class="fas fa-user-shield" style="font-size: 4rem; color: #2a5298; margin-bottom: 20px;"></i>
                    <p style="margin-bottom: 20px; font-size: 1.1rem;">æ‚¨é€‰æ‹©äº†"åå‹¤èŒå·¥"èº«ä»½ï¼Œè¯·è¾“å…¥ç®¡ç†å‘˜PINç ä»¥å¯ç”¨ç®¡ç†åŠŸèƒ½</p>
                </div>
                
                <div class="control-group" style="margin-bottom: 30px;">
                    <label for="pin-code"><i class="fas fa-key"></i> ç®¡ç†å‘˜PINç </label>
                    <input type="password" id="pin-code" class="pin-input" placeholder="è¯·è¾“å…¥6ä½PINç " maxlength="6">
                    <p style="font-size: 0.9rem; color: #6c757d; margin-top: 10px;                </div>
                
                <div class="buttons" style="justify-content: center;">
                    <button id="cancel-pin" class="btn btn-secondary">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                    <button id="verify-pin" class="btn btn-primary">
                        <i class="fas fa-check"></i> éªŒè¯
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç¼–è¾‘æ ‡è®°å¼¹çª— -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2><i class="fas fa-edit"></i> ç¼–è¾‘é—®é¢˜åé¦ˆ</h2>
            
            <div class="modal-form">
                <div class="control-group" style="margin-bottom: 20px;">
                    <label for="edit-title"><i class="fas fa-heading"></i> é—®é¢˜æ ‡é¢˜</label>
                    <input type="text" id="edit-title" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸‰å­¦ç”Ÿé£Ÿå ‚æ—©é¤ä¾›åº”ä¸è¶³" maxlength="50">
                </div>
                
                <div class="control-group" style="margin-bottom: 20px;">
                    <label for="edit-description"><i class="fas fa-align-left"></i> é—®é¢˜æè¿°</label>
                    <textarea id="edit-description" rows="4" placeholder="è¯·è¯¦ç»†æè¿°é—®é¢˜æƒ…å†µï¼ŒåŒ…æ‹¬ç°è±¡ã€å½±å“èŒƒå›´ã€å‘ç”Ÿæ—¶é—´ç­‰..."></textarea>
                </div>
                
                <div class="controls-grid" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="edit-problem-type"><i class="fas fa-tag"></i> é—®é¢˜ç±»å‹</label>
                        <select id="edit-problem-type">
                            <option value="dormitory">ğŸ›ï¸ å®¿èˆç®¡ç†ä¸æœåŠ¡</option>
                            <option value="canteen">ğŸ½ï¸ é£Ÿå ‚é¤é¥®æœåŠ¡</option>
                            <option value="facilities">ğŸ”§ å…¬å…±è®¾æ–½ç»´æŠ¤</option>
                            <option value="sanitation">ğŸ§¹ æ ¡å›­ç¯å¢ƒå«ç”Ÿ</option>
                            <option value="security">ğŸ›¡ï¸ æ ¡å›­å®‰å…¨ä¿éšœ</option>
                            <option value="water">ğŸ’§ æ°´ç”µä¾›åº”æœåŠ¡</option>
                            <option value="repair">ğŸ”¨ ç»´ä¿®å“åº”æ•ˆç‡</option>
                            <option value="other">ğŸ“ å…¶ä»–æ„è§å»ºè®®</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="edit-urgency"><i class="fas fa-exclamation-triangle"></i> ç´§æ€¥ç¨‹åº¦</label>
                        <select id="edit-urgency">
                            <option value="low">ğŸŸ¢ å»ºè®®æ”¹è¿› - éç´§æ€¥ï¼Œå¯çº³å…¥é•¿æœŸè§„åˆ’</option>
                            <option value="medium">ğŸŸ¡ éœ€è¦å…³æ³¨ - çŸ­æœŸå†…åº”è§£å†³</option>
                            <option value="high">ğŸ”´ ç´§æ€¥é—®é¢˜ - éœ€ç«‹å³å¤„ç†</option>
                        </select>
                    </div>
                </div>
                
                <div class="controls-grid" style="margin-bottom: 20px;">
                    <div class="control-group">
                        <label for="edit-user-name"><i class="fas fa-user"></i> åé¦ˆäººå§“å</label>
                        <input type="text" id="edit-user-name" placeholder="åé¦ˆäººå§“å">
                    </div>
                    
                    <div class="control-group">
                        <label for="edit-user-contact"><i class="fas fa-phone"></i> è”ç³»æ–¹å¼</label>
                        <input type="text" id="edit-user-contact" placeholder="è”ç³»æ–¹å¼">
                    </div>
                </div>
                
                <div class="control-group" style="margin-bottom: 30px;">
                    <label for="edit-suggestion"><i class="fas fa-lightbulb"></i> å»ºè®®</label>
                    <textarea id="edit-suggestion" rows="3" placeholder="æ”¹è¿›å»ºè®®..."></textarea>
                </div>
                
                <div class="buttons">
                    <button id="cancel-edit" class="btn btn-secondary">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                    <button id="save-edit" class="btn btn-primary">
                        <i class="fas fa-save"></i> ä¿å­˜ä¿®æ”¹
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================
        // è‚‡åº†å­¦é™¢åå‹¤æœåŠ¡å·¥ä½œåº§è°ˆä¼šåé¦ˆç³»ç»Ÿ
        // ç®¡ç†å‘˜åŠŸèƒ½å¢å¼ºç‰ˆ
        // ========================
        
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å˜é‡
            let markers = [];
            let currentMarker = null;
            let currentCategory = 'all';
            let isDragging = false;
            let startX, startY, initialX, initialY;
            let isAdmin = false;
            let currentEditingMarker = null;
            
            // DOM å…ƒç´ 
            const mapImg = document.getElementById('zqu-map');
            const markersList = document.getElementById('markers-list');
            const markerModal = document.getElementById('marker-modal');
            const detailModal = document.getElementById('detail-modal');
            const pinModal = document.getElementById('pin-modal');
            const editModal = document.getElementById('edit-modal');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const cancelMarkerBtn = document.getElementById('cancel-marker');
            const saveMarkerBtn = document.getElementById('save-marker');
            const helpBtn = document.getElementById('help-btn');
            const adminLogoutBtn = document.getElementById('admin-logout');
            const categoryButtons = document.querySelectorAll('.category-btn');
            const userDepartmentSelect = document.getElementById('user-department');
            const adminBadge = document.getElementById('admin-badge');
            
            // PINç ç›¸å…³å…ƒç´ 
            const cancelPinBtn = document.getElementById('cancel-pin');
            const verifyPinBtn = document.getElementById('verify-pin');
            const pinCodeInput = document.getElementById('pin-code');
            
            // ç¼–è¾‘ç›¸å…³å…ƒç´ 
            const cancelEditBtn = document.getElementById('cancel-edit');
            const saveEditBtn = document.getElementById('save-edit');
            
            // é—®é¢˜ç±»å‹ä¸é¢œè‰²å¯¹åº”å…³ç³»
            const typeColors = {
                dormitory: '#084298',
                canteen: '#0a3622',
                facilities: '#664d03',
                sanitation: '#842029',
                security: '#41464b',
                water: '#055160',
                repair: '#842029',
                other: '#41464b'
            };
            
            const urgencyColors = {
                low: '#28a745',
                medium: '#ffc107',
                high: '#dc3545'
            };
            
            // å›¾æ ‡æ˜ å°„
            const typeIcons = {
                dormitory: 'ğŸ›ï¸',
                canteen: 'ğŸ½ï¸',
                facilities: 'ğŸ”§',
                sanitation: 'ğŸ§¹',
                security: 'ğŸ›¡ï¸',
                water: 'ğŸ’§',
                repair: 'ğŸ”¨',
                other: 'ğŸ“'
            };
            
            // ========================
            // ç®¡ç†å‘˜åŠŸèƒ½åˆå§‹åŒ–
            // ========================
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„ç®¡ç†å‘˜çŠ¶æ€
            const savedAdminState = localStorage.getItem('zqu-isAdmin');
            if (savedAdminState === 'true') {
                isAdmin = true;
                updateAdminUI();
            }
            
            // ========================
            // åœ°å›¾åˆå§‹åŒ–ï¼ˆå›¾ç‰‡ç‰ˆï¼‰
            // ========================
            
            function initMap() {
                // å›¾ç‰‡ç‚¹å‡»äº‹ä»¶ - æ·»åŠ æ ‡è®°
                mapImg.addEventListener('click', function(e) {
                    if (isDragging) return; // å¦‚æœæ˜¯æ‹–åŠ¨æ“ä½œï¼Œä¸æ·»åŠ æ ‡è®°
                    
                    // è·å–ç‚¹å‡»ä½ç½®ç›¸å¯¹äºå›¾ç‰‡çš„åæ ‡
                    const rect = this.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // è®¡ç®—ç›¸å¯¹äºå›¾ç‰‡å°ºå¯¸çš„ç™¾åˆ†æ¯”åæ ‡
                    const percentX = (x / rect.width) * 100;
                    const percentY = (y / rect.height) * 100;
                    
                    // è·å–ä½ç½®æè¿°
                    let locationName = getLocationName(percentX, percentY);
                    
                    // æ‰“å¼€æ ‡è®°å¼¹çª—
                    openMarkerModal(percentX, percentY, locationName);
                });
                
                // å›¾ç‰‡æ‹–åŠ¨åŠŸèƒ½
                mapImg.addEventListener('mousedown', startDrag);
                mapImg.addEventListener('touchstart', startDrag);
                
                document.addEventListener('mousemove', drag);
                document.addEventListener('touchmove', drag);
                
                document.addEventListener('mouseup', endDrag);
                document.addEventListener('touchend', endDrag);
                
                // åŠ è½½å·²ä¿å­˜çš„æ ‡è®°
                loadMarkersFromLocal();
            }
            
            // æ‹–åŠ¨åŠŸèƒ½å‡½æ•°
            function startDrag(e) {
                isDragging = true;
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                startX = clientX;
                startY = clientY;
                
                initialX = mapImg.offsetLeft || 0;
                initialY = mapImg.offsetTop || 0;
                
                mapImg.style.cursor = 'grabbing';
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const clientX = e.clientX || e.touches[0].clientX;
                const clientY = e.clientY || e.touches[0].clientY;
                
                const dx = clientX - startX;
                const dy = clientY - startY;
                
                mapImg.style.position = 'relative';
                mapImg.style.left = (initialX + dx) + 'px';
                mapImg.style.top = (initialY + dy) + 'px';
                
                // æ›´æ–°æ ‡è®°ä½ç½®
                updateMarkersPosition();
                
                e.preventDefault();
            }
            
            function endDrag() {
                isDragging = false;
                mapImg.style.cursor = 'crosshair';
            }
            
            // è·å–ä½ç½®åç§°ï¼ˆç®€åŒ–ç‰ˆï¼Œå¯ä»¥æ ¹æ®å®é™…åœ°å›¾åŒºåŸŸè°ƒæ•´ï¼‰
            function getLocationName(xPercent, yPercent) {
                // è¿™é‡Œæ ¹æ®ç™¾åˆ†æ¯”åæ ‡åˆ¤æ–­å¤§æ¦‚ä½ç½®
                // å®é™…ä½¿ç”¨æ—¶å¯ä»¥æ ¹æ®è‚‡åº†å­¦é™¢åœ°å›¾çš„å…·ä½“åŒºåŸŸæ¥ç»†åŒ–
                if (xPercent < 30 && yPercent < 30) return 'åŒ—æ ¡åŒº';
                if (xPercent > 70 && yPercent < 30) return 'ä¸œæ ¡åŒº';
                if (xPercent < 30 && yPercent > 70) return 'è¥¿æ ¡åŒº';
                if (xPercent > 70 && yPercent > 70) return 'å—æ ¡åŒº';
                if (xPercent > 40 && xPercent < 60 && yPercent > 40 && yPercent < 60) return 'ä¸­å¿ƒåŒºåŸŸ';
                
                return 'æ ¡å›­åŒºåŸŸ';
            }
            
            // æ›´æ–°æ ‡è®°ä½ç½®ï¼ˆå½“å›¾ç‰‡è¢«æ‹–åŠ¨æ—¶ï¼‰
            function updateMarkersPosition() {
                const markers = document.querySelectorAll('.map-marker');
                markers.forEach(marker => {
                    const id = marker.dataset.id;
                    const markerData = markers.find(m => m.id === id);
                    if (markerData) {
                        const rect = mapImg.getBoundingClientRect();
                        const x = (markerData.x / 100) * rect.width;
                        const y = (markerData.y / 100) * rect.height;
                        
                        marker.style.left = x + 'px';
                        marker.style.top = y + 'px';
                    }
                });
            }
            
            // ========================
            // ç®¡ç†å‘˜åŠŸèƒ½
            // ========================
            
            // æ›´æ–°ç®¡ç†å‘˜UI
            function updateAdminUI() {
                if (isAdmin) {
                    adminBadge.style.display = 'block';
                    adminLogoutBtn.style.display = 'flex';
                    showNotification('å·²è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼', 'success');
                } else {
                    adminBadge.style.display = 'none';
                    adminLogoutBtn.style.display = 'none';
                }
            }
            
            // éªŒè¯PINç 
            function verifyPIN(pin) {
                // è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼
                return pin === '105105';
            }
            
            // æ˜¾ç¤ºPINç éªŒè¯å¼¹çª—
            function showPinModal() {
                pinCodeInput.value = '';
                pinModal.style.display = 'flex';
                pinCodeInput.focus();
            }
            
            // å¤„ç†ç”¨æˆ·èº«ä»½å˜æ›´
            userDepartmentSelect.addEventListener('change', function() {
                const selectedValue = this.value;
                
                // å¦‚æœé€‰æ‹©äº†åå‹¤èŒå·¥ï¼Œä¸”å½“å‰ä¸æ˜¯ç®¡ç†å‘˜ï¼Œåˆ™æ˜¾ç¤ºPINç éªŒè¯
                if (selectedValue === 'worker' && !isAdmin) {
                    showPinModal();
                }
            });
            
            // PINç éªŒè¯äº‹ä»¶
            verifyPinBtn.addEventListener('click', function() {
                const pin = pinCodeInput.value.trim();
                
                if (!pin) {
                    showNotification('è¯·è¾“å…¥PINç ', 'error');
                    return;
                }
                
                if (verifyPIN(pin)) {
                    isAdmin = true;
                    localStorage.setItem('zqu-isAdmin', 'true');
                    updateAdminUI();
                    pinModal.style.display = 'none';
                    showNotification('PINç éªŒè¯æˆåŠŸï¼Œå·²è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼', 'success');
                } else {
                    showNotification('PINç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥', 'error');
                    pinCodeInput.value = '';
                    pinCodeInput.focus();
                }
            });
            
            // å–æ¶ˆPINç éªŒè¯
            cancelPinBtn.addEventListener('click', function() {
                pinModal.style.display = 'none';
                userDepartmentSelect.value = 'student'; // é‡ç½®ä¸ºé»˜è®¤å€¼
            });
            
            // é€€å‡ºç®¡ç†å‘˜æ¨¡å¼
            adminLogoutBtn.addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦é€€å‡ºç®¡ç†å‘˜æ¨¡å¼å—ï¼Ÿ')) {
                    isAdmin = false;
                    localStorage.removeItem('zqu-isAdmin');
                    updateAdminUI();
                    userDepartmentSelect.value = 'student';
                    showNotification('å·²é€€å‡ºç®¡ç†å‘˜æ¨¡å¼', 'info');
                }
            });
            
            // ========================
            // æ ‡è®°ç®¡ç†
            // ========================
            
            function openMarkerModal(x, y, locationName = '') {
                currentMarker = { x, y, locationName };
                
                // å¦‚æœçŸ¥é“ä½ç½®ï¼Œè‡ªåŠ¨å¡«å……æ ‡é¢˜
                if (locationName && locationName !== 'æ ¡å›­åŒºåŸŸ') {
                    document.getElementById('marker-title').value = `${locationName} - åå‹¤é—®é¢˜åé¦ˆ`;
                } else {
                    document.getElementById('marker-title').value = '';
                }
                
                // æ¸…ç©ºå…¶ä»–å­—æ®µ
                document.getElementById('marker-description').value = '';
                document.getElementById('suggestion').value = '';
                document.getElementById('user-name').value = '';
                document.getElementById('user-contact').value = '';
                
                // åŒæ­¥ä¸‹æ‹‰èœå•å€¼
                const problemType = document.getElementById('problem-type').value;
                const urgencyLevel = document.getElementById('urgency-level').value;
                
                document.getElementById('modal-problem-type').value = problemType;
                document.getElementById('modal-urgency').value = urgencyLevel;
                
                markerModal.style.display = 'flex';
            }
            
            function saveMarker() {
                const title = document.getElementById('marker-title').value.trim();
                const description = document.getElementById('marker-description').value.trim();
                const problemType = document.getElementById('modal-problem-type').value;
                const urgency = document.getElementById('modal-urgency').value;
                const userName = document.getElementById('user-name').value.trim();
                const userContact = document.getElementById('user-contact').value.trim();
                const suggestion = document.getElementById('suggestion').value.trim();
                
                if (!title) {
                    alert('è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜');
                    return;
                }
                
                if (!description) {
                    alert('è¯·è¾“å…¥é—®é¢˜æè¿°');
                    return;
                }
                
                const marker = {
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    x: currentMarker.x,
                    y: currentMarker.y,
                    title,
                    description,
                    problemType,
                    urgency,
                    userName: userName || 'åŒ¿å',
                    userContact,
                    suggestion,
                    locationName: currentMarker.locationName || 'æ ¡å›­åŒºåŸŸ',
                    status: 'pending', // pending, in-progress, resolved
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    votes: 0, // èµåŒäººæ•°
                    comments: [] // å…¶ä»–ç”¨æˆ·çš„è¯„è®º
                };
                
                markers.push(marker);
                addMarkerToMap(marker);
                updateMarkersList();
                saveMarkersToLocal();
                
                markerModal.style.display = 'none';
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showNotification(`é—®é¢˜åé¦ˆå·²æäº¤ï¼ç¼–å·: ${marker.id.substr(-6)}`, 'success');
            }
            
            function addMarkerToMap(marker) {
                // ç¡®ä¿åœ°å›¾å®¹å™¨æ˜¯ç›¸å¯¹å®šä½
                const mapWrapper = mapImg.parentElement;
                mapWrapper.style.position = 'relative';
                
                // è®¡ç®—å®é™…åƒç´ ä½ç½®
                const rect = mapImg.getBoundingClientRect();
                const x = (marker.x / 100) * rect.width;
                const y = (marker.y / 100) * rect.height;
                
                // åˆ›å»ºæ ‡è®°å®¹å™¨
                const markerDiv = document.createElement('div');
                markerDiv.className = 'map-marker';
                markerDiv.dataset.id = marker.id;
                markerDiv.style.left = `${x}px`;
                markerDiv.style.top = `${y}px`;
                markerDiv.style.position = 'absolute';
                markerDiv.style.transform = 'translate(-50%, -50%)';
                markerDiv.style.zIndex = '10';
                
                // è·å–é—®é¢˜ç±»å‹å¯¹åº”çš„é¢œè‰²å’Œå›¾æ ‡
                const color = typeColors[marker.problemType] || '#41464b';
                const icon = typeIcons[marker.problemType] || 'ğŸ“Œ';
                
                markerDiv.innerHTML = `
                    <div class="marker-icon marker-${marker.problemType}" style="font-size: 2.5rem; color: ${color};">
                        ${icon}
                    </div>
                    ${marker.urgency === 'high' ? 
                        `<div class="marker-badge" style="background: ${urgencyColors[marker.urgency]}">!</div>` : ''}
                `;
                
                // ç‚¹å‡»äº‹ä»¶
                markerDiv.addEventListener('click', function(e) {
                    e.stopPropagation();
                    showMarkerDetails(marker);
                });
                
                mapWrapper.appendChild(markerDiv);
            }
            
            function showMarkerDetails(marker) {
                const detailContent = document.getElementById('detail-content');
                
                // çŠ¶æ€æ ‡ç­¾
                let statusBadge = '';
                switch(marker.status) {
                    case 'pending':
                        statusBadge = '<span style="background: #ffc107; color: #000; padding: 3px 8px; border-radius: 12px; font-size: 0.85rem;">å¾…å¤„ç†</span>';
                        break;
                    case 'in-progress':
                        statusBadge = '<span style="background: #17a2b8; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.85rem;">å¤„ç†ä¸­</span>';
                        break;
                    case 'resolved':
                        statusBadge = '<span style="background: #28a745; color: white; padding: 3px 8px; border-radius: 12px; font-size: 0.85rem;">å·²è§£å†³</span>';
                        break;
                }
                
                // ç´§æ€¥ç¨‹åº¦æ ‡ç­¾
                let urgencyText = '';
                switch(marker.urgency) {
                    case 'low':
                        urgencyText = '<span style="color: #28a745;">ğŸŸ¢ å»ºè®®æ”¹è¿›</span>';
                        break;
                    case 'medium':
                        urgencyText = '<span style="color: #ffc107;">ğŸŸ¡ éœ€è¦å…³æ³¨</span>';
                        break;
                    case 'high':
                        urgencyText = '<span style="color: #dc3545;">ğŸ”´ ç´§æ€¥é—®é¢˜</span>';
                        break;
                }
                
                // é—®é¢˜ç±»å‹æ ‡ç­¾
                const typeText = {
                    dormitory: 'ğŸ›ï¸ å®¿èˆç®¡ç†ä¸æœåŠ¡',
                    canteen: 'ğŸ½ï¸ é£Ÿå ‚é¤é¥®æœåŠ¡',
                    facilities: 'ğŸ”§ å…¬å…±è®¾æ–½ç»´æŠ¤',
                    sanitation: 'ğŸ§¹ æ ¡å›­ç¯å¢ƒå«ç”Ÿ',
                    security: 'ğŸ›¡ï¸ æ ¡å›­å®‰å…¨ä¿éšœ',
                    water: 'ğŸ’§ æ°´ç”µä¾›åº”æœåŠ¡',
                    repair: 'ğŸ”¨ ç»´ä¿®å“åº”æ•ˆç‡',
                    other: 'ğŸ“ å…¶ä»–æ„è§å»ºè®®'
                }[marker.problemType] || 'ğŸ“ å…¶ä»–æ„è§å»ºè®®';
                
                // ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤ºï¼ˆç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°çœŸå®ä¿¡æ¯ï¼‰
                let userInfoDisplay = `<p><strong>æ˜¾ç¤ºåç§°ï¼š</strong>${marker.userName}</p>`;
                
                if (isAdmin) {
                    // ç®¡ç†å‘˜å¯ä»¥çœ‹åˆ°çœŸå®è”ç³»æ–¹å¼
                    userInfoDisplay += `
                        ${marker.userContact ? `<p><strong>è”ç³»æ–¹å¼ï¼š</strong>${marker.userContact}</p>` : ''}
                        <p><strong>åé¦ˆIDï¼š</strong>${marker.id}</p>
                    `;
                }
                
                // æ„å»ºè¯¦æƒ…HTML
                let detailHTML = `
                    <h2 style="margin-bottom: 20px; color: #2a5298;">
                        <i class="fas fa-info-circle"></i> é—®é¢˜åé¦ˆè¯¦æƒ…
                    </h2>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="margin: 0; color: #2a5298;">${marker.title}</h3>
                            ${statusBadge}
                        </div>
                        
                        <div style="display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-map-marker-alt" style="color: #6c757d;"></i>
                                <span>${marker.locationName}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-tag" style="color: #6c757d;"></i>
                                <span>${typeText}</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <i class="fas fa-exclamation-triangle" style="color: #6c757d;"></i>
                                <span>${urgencyText}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #495057;">
                            <i class="fas fa-align-left"></i> é—®é¢˜æè¿°
                        </h4>
                        <p style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                            ${marker.description.replace(/\n/g, '<br>')}
                        </p>
                    </div>
                    
                    ${marker.suggestion ? `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #495057;">
                            <i class="fas fa-lightbulb"></i> æ”¹è¿›å»ºè®®
                        </h4>
                        <p style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                            ${marker.suggestion.replace(/\n/g, '<br>')}
                        </p>
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                        <div>
                            <h4 style="margin-bottom: 10px; color: #495057;">
                                <i class="fas fa-user"></i> åé¦ˆäººä¿¡æ¯
                            </h4>
                            <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                                ${userInfoDisplay}
                                <p><strong>åé¦ˆæ—¶é—´ï¼š</strong>${new Date(marker.createdAt).toLocaleString()}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 10px; color: #495057;">
                                <i class="fas fa-chart-bar"></i> åé¦ˆç»Ÿè®¡
                            </h4>
                            <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #dee2e6;">
                                <p><strong>èµåŒäººæ•°ï¼š</strong>${marker.votes} äºº</p>
                                <p><strong>è¯„è®ºæ•°é‡ï¼š</strong>${marker.comments.length} æ¡</p>
                                <p><strong>æœ€åæ›´æ–°ï¼š</strong>${new Date(marker.updatedAt).toLocaleString()}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                // è¯„è®ºéƒ¨åˆ†
                if (marker.comments.length > 0) {
                    detailHTML += `
                    <div style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #495057;">
                            <i class="fas fa-comments"></i> ç”¨æˆ·è¯„è®º (${marker.comments.length})
                        </h4>
                        <div style="max-height: 200px; overflow-y: auto; padding-right: 10px;">
                            ${marker.comments.map((comment, index) => {
                                let commentActions = '';
                                if (isAdmin) {
                                    commentActions = `
                                        <div class="comment-actions">
                                            <button onclick="deleteComment('${marker.id}', ${index})" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;">
                                                <i class="fas fa-trash"></i> åˆ é™¤
                                            </button>
                                        </div>
                                    `;
                                }
                                
                                return `
                                    <div class="comment-item">
                                        <div class="comment-header">
                                            <div class="comment-user">${comment.userName}</div>
                                            <div class="comment-time">${new Date(comment.createdAt).toLocaleString()}</div>
                                        </div>
                                        <div class="comment-text">${comment.text}</div>
                                        ${commentActions}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    `;
                }
                
                // æ“ä½œæŒ‰é’®
                let actionButtons = `
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button onclick="voteForMarker('${marker.id}')" class="btn btn-primary" style="padding: 10px 20px;">
                            <i class="fas fa-thumbs-up"></i> èµåŒ (${marker.votes})
                        </button>
                        <button onclick="addComment('${marker.id}')" class="btn btn-secondary" style="padding: 10px 20px;">
                            <i class="fas fa-comment"></i> æ·»åŠ è¯„è®º
                        </button>
                `;
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºæ›´å¤šç®¡ç†æŒ‰é’®
                if (isAdmin) {
                    actionButtons += `
                        <button onclick="editMarker('${marker.id}')" class="btn btn-warning" style="padding: 10px 20px;">
                            <i class="fas fa-edit"></i> ç¼–è¾‘é—®é¢˜
                        </button>
                        <button onclick="deleteMarker('${marker.id}')" class="btn btn-danger" style="padding: 10px 20px;">
                            <i class="fas fa-trash"></i> åˆ é™¤é—®é¢˜
                        </button>
                        <button onclick="changeStatus('${marker.id}')" class="btn btn-info" style="padding: 10px 20px;">
                            <i class="fas fa-check"></i> æ›´æ–°çŠ¶æ€
                        </button>
                    `;
                }
                
                actionButtons += `</div>`;
                
                detailHTML += actionButtons;
                
                // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºç®¡ç†é¢æ¿
                if (isAdmin) {
                    detailHTML += `
                        <div class="admin-panel">
                            <h3><i class="fas fa-user-shield"></i> ç®¡ç†å‘˜é¢æ¿</h3>
                            <div class="admin-actions">
                                <button onclick="exportMarkerData('${marker.id}')" class="btn btn-info" style="padding: 8px 15px;">
                                    <i class="fas fa-download"></i> å¯¼å‡ºæ­¤é—®é¢˜æ•°æ®
                                </button>
                                <button onclick="showMarkerLog('${marker.id}')" class="btn btn-secondary" style="padding: 8px 15px;">
                                    <i class="fas fa-history"></i> æŸ¥çœ‹æ“ä½œè®°å½•
                                </button>
                                <button onclick="contactSubmitter('${marker.id}')" class="btn btn-success" style="padding: 8px 15px;">
                                    <i class="fas fa-envelope"></i> è”ç³»åé¦ˆäºº
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                detailContent.innerHTML = detailHTML;
                
                // æ·»åŠ å…¨å±€å‡½æ•°ï¼ˆåœ¨å¼¹çª—ä¸­ä½¿ç”¨ï¼‰
                window.voteForMarker = function(id) {
                    const marker = markers.find(m => m.id === id);
                    if (marker) {
                        marker.votes++;
                        marker.updatedAt = new Date().toISOString();
                        saveMarkersToLocal();
                        showMarkerDetails(marker);
                        showNotification('æ„Ÿè°¢æ‚¨çš„èµåŒï¼', 'success');
                    }
                };
                
                window.addComment = function(id) {
                    const comment = prompt('è¯·è¾“å…¥æ‚¨çš„è¯„è®ºï¼š');
                    if (comment && comment.trim()) {
                        const marker = markers.find(m => m.id === id);
                        if (marker) {
                            marker.comments.push({
                                userName: localStorage.getItem('zqu-userName') || (isAdmin ? 'åå‹¤ç®¡ç†å‘˜' : 'åŒ¿åç”¨æˆ·'),
                                text: comment.trim(),
                                createdAt: new Date().toISOString()
                            });
                            marker.updatedAt = new Date().toISOString();
                            saveMarkersToLocal();
                            showMarkerDetails(marker);
                            showNotification('è¯„è®ºå·²æ·»åŠ ï¼', 'success');
                        }
                    }
                };
                
                window.deleteComment = function(markerId, commentIndex) {
                    if (!isAdmin) {
                        showNotification('æ— æƒæ‰§è¡Œæ­¤æ“ä½œ', 'error');
                        return;
                    }
                    
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) {
                        const marker = markers.find(m => m.id === markerId);
                        if (marker && marker.comments[commentIndex]) {
                            marker.comments.splice(commentIndex, 1);
                            marker.updatedAt = new Date().toISOString();
                            saveMarkersToLocal();
                            showMarkerDetails(marker);
                            showNotification('è¯„è®ºå·²åˆ é™¤', 'success');
                        }
                    }
                };
                
                window.changeStatus = function(id) {
                    const marker = markers.find(m => m.id === id);
                    if (marker) {
                        const status = prompt('è¯·è¾“å…¥æ–°çš„çŠ¶æ€ (pending:å¾…å¤„ç†, in-progress:å¤„ç†ä¸­, resolved:å·²è§£å†³):', marker.status);
                        if (status && ['pending', 'in-progress', 'resolved'].includes(status)) {
                            marker.status = status;
                            marker.updatedAt = new Date().toISOString();
                            saveMarkersToLocal();
                            updateMarkersList();
                            showMarkerDetails(marker);
                            showNotification('çŠ¶æ€å·²æ›´æ–°ï¼', 'success');
                        }
                    }
                };
                
                window.editMarker = function(id) {
                    if (!isAdmin) {
                        showNotification('æ— æƒæ‰§è¡Œæ­¤æ“ä½œ', 'error');
                        return;
                    }
                    
                    currentEditingMarker = markers.find(m => m.id === id);
                    if (currentEditingMarker) {
                        // å¡«å……ç¼–è¾‘è¡¨å•
                        document.getElementById('edit-title').value = currentEditingMarker.title;
                        document.getElementById('edit-description').value = currentEditingMarker.description;
                        document.getElementById('edit-problem-type').value = currentEditingMarker.problemType;
                        document.getElementById('edit-urgency').value = currentEditingMarker.urgency;
                        document.getElementById('edit-user-name').value = currentEditingMarker.userName;
                        document.getElementById('edit-user-contact').value = currentEditingMarker.userContact || '';
                        document.getElementById('edit-suggestion').value = currentEditingMarker.suggestion || '';
                        
                        detailModal.style.display = 'none';
                        editModal.style.display = 'flex';
                    }
                };
                
                window.deleteMarker = function(id) {
                    if (!isAdmin) {
                        showNotification('æ— æƒæ‰§è¡Œæ­¤æ“ä½œ', 'error');
                        return;
                    }
                    
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé—®é¢˜åé¦ˆå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                        const markerIndex = markers.findIndex(m => m.id === id);
                        if (markerIndex !== -1) {
                            // ä»æ•°ç»„ä¸­åˆ é™¤
                            markers.splice(markerIndex, 1);
                            
                            // ä»åœ°å›¾ä¸Šåˆ é™¤æ ‡è®°
                            const markerDiv = document.querySelector(`.map-marker[data-id="${id}"]`);
                            if (markerDiv) {
                                markerDiv.remove();
                            }
                            
                            // æ›´æ–°åˆ—è¡¨å’Œä¿å­˜æ•°æ®
                            updateMarkersList();
                            saveMarkersToLocal();
                            
                            detailModal.style.display = 'none';
                            showNotification('é—®é¢˜åé¦ˆå·²åˆ é™¤', 'success');
                        }
                    }
                };
                
                // ç®¡ç†å‘˜é¢å¤–åŠŸèƒ½
                window.exportMarkerData = function(id) {
                    const marker = markers.find(m => m.id === id);
                    if (marker) {
                        const dataStr = JSON.stringify(marker, null, 2);
                        const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                        
                        const link = document.createElement('a');
                        link.setAttribute('href', dataUri);
                        link.setAttribute('download', `é—®é¢˜åé¦ˆ_${id}.json`);
                        link.click();
                        
                        showNotification('æ•°æ®å·²å¯¼å‡º', 'success');
                    }
                };
                
                window.showMarkerLog = function(id) {
                    alert('æ“ä½œè®°å½•åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­...');
                };
                
                window.contactSubmitter = function(id) {
                    const marker = markers.find(m => m.id === id);
                    if (marker && marker.userContact) {
                        alert(`åé¦ˆäººè”ç³»æ–¹å¼ï¼š${marker.userContact}\n\næ‚¨å¯ä»¥é€šè¿‡æ­¤æ–¹å¼è”ç³»åé¦ˆäººã€‚`);
                    } else {
                        alert('è¯¥åé¦ˆäººæœªæä¾›è”ç³»æ–¹å¼ã€‚');
                    }
                };
                
                detailModal.style.display = 'flex';
            }
            
            // ä¿å­˜ç¼–è¾‘
            saveEditBtn.addEventListener('click', function() {
                if (!currentEditingMarker) return;
                
                const title = document.getElementById('edit-title').value.trim();
                const description = document.getElementById('edit-description').value.trim();
                const problemType = document.getElementById('edit-problem-type').value;
                const urgency = document.getElementById('edit-urgency').value;
                const userName = document.getElementById('edit-user-name').value.trim();
                const userContact = document.getElementById('edit-user-contact').value.trim();
                const suggestion = document.getElementById('edit-suggestion').value.trim();
                
                if (!title) {
                    alert('è¯·è¾“å…¥é—®é¢˜æ ‡é¢˜');
                    return;
                }
                
                if (!description) {
                    alert('è¯·è¾“å…¥é—®é¢˜æè¿°');
                    return;
                }
                
                // æ›´æ–°æ ‡è®°ä¿¡æ¯
                currentEditingMarker.title = title;
                currentEditingMarker.description = description;
                currentEditingMarker.problemType = problemType;
                currentEditingMarker.urgency = urgency;
                currentEditingMarker.userName = userName;
                currentEditingMarker.userContact = userContact;
                currentEditingMarker.suggestion = suggestion;
                currentEditingMarker.updatedAt = new Date().toISOString();
                
                // æ›´æ–°åœ°å›¾ä¸Šçš„æ ‡è®°ï¼ˆé‡æ–°åˆ›å»ºæ ‡è®°ä»¥æ›´æ–°é¢œè‰²/å›¾æ ‡ï¼‰
                const markerDiv = document.querySelector(`.map-marker[data-id="${currentEditingMarker.id}"]`);
                if (markerDiv) {
                    markerDiv.remove();
                    addMarkerToMap(currentEditingMarker);
                }
                
                // æ›´æ–°åˆ—è¡¨å’Œä¿å­˜æ•°æ®
                updateMarkersList();
                saveMarkersToLocal();
                
                editModal.style.display = 'none';
                showNotification('é—®é¢˜åé¦ˆå·²æ›´æ–°', 'success');
                
                // é‡æ–°æ˜¾ç¤ºè¯¦æƒ…
                showMarkerDetails(currentEditingMarker);
            });
            
            // å–æ¶ˆç¼–è¾‘
            cancelEditBtn.addEventListener('click', function() {
                editModal.style.display = 'none';
                detailModal.style.display = 'flex';
            });
            
            // ========================
            // æ ‡è®°åˆ—è¡¨ç®¡ç†
            // ========================
            
            function updateMarkersList() {
                markersList.innerHTML = '';
                
                // è¿‡æ»¤æ ‡è®°ï¼ˆæŒ‰åˆ†ç±»ï¼‰
                let filteredMarkers = markers;
                if (currentCategory !== 'all') {
                    filteredMarkers = markers.filter(m => m.problemType === currentCategory);
                }
                
                if (filteredMarkers.length === 0) {
                    markersList.innerHTML = `
                        <div class="no-markers">
                            <p style="text-align: center; color: #6c757d; padding: 40px 20px;">
                                <i class="fas fa-map-pin" style="font-size: 3rem; color: #dee2e6; margin-bottom: 15px; display: block;"></i>
                                ${currentCategory === 'all' ? 'æš‚æ— åé¦ˆ' : 'æ­¤åˆ†ç±»æš‚æ— åé¦ˆ'}<br>
                                ç‚¹å‡»åœ°å›¾æ·»åŠ é—®é¢˜æ ‡è®°
                            </p>
                        </div>
                    `;
                    return;
                }
                
                // æŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
                filteredMarkers.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                // ç”Ÿæˆæ ‡è®°åˆ—è¡¨
                filteredMarkers.forEach(marker => {
                    const markerItem = document.createElement('div');
                    markerItem.className = 'marker-item';
                    markerItem.dataset.id = marker.id;
                    
                    // çŠ¶æ€é¢œè‰²
                    let statusColor = '#6c757d';
                    let statusText = 'å¾…å¤„ç†';
                    if (marker.status === 'in-progress') {
                        statusColor = '#17a2b8';
                        statusText = 'å¤„ç†ä¸­';
                    } else if (marker.status === 'resolved') {
                        statusColor = '#28a745';
                        statusText = 'å·²è§£å†³';
                    }
                    
                    // ç´§æ€¥ç¨‹åº¦å›¾æ ‡
                    let urgencyIcon = 'ğŸŸ¢';
                    if (marker.urgency === 'medium') urgencyIcon = 'ğŸŸ¡';
                    if (marker.urgency === 'high') urgencyIcon = 'ğŸ”´';
                    
                    // å¦‚æœæ˜¯ç®¡ç†å‘˜ï¼Œæ˜¾ç¤ºæ›´å¤šä¿¡æ¯
                    let adminInfo = '';
                    if (isAdmin && marker.userName !== 'åŒ¿å') {
                        adminInfo = `<div style="font-size: 0.8rem; color: #28a745;"><i class="fas fa-user-check"></i> å®ååé¦ˆ</div>`;
                    }
                    
                    markerItem.innerHTML = `
                        <div class="marker-header">
                            <div class="marker-title">${typeIcons[marker.problemType]} ${marker.title}</div>
                            <span style="font-size: 0.85rem; color: ${statusColor};">${statusText}</span>
                        </div>
                        
                        ${adminInfo}
                        
                        <div class="marker-location">
                            <i class="fas fa-map-marker-alt"></i> ${marker.locationName}
                        </div>
                        
                        <div class="marker-problem">
                            <i class="fas fa-exclamation-circle"></i> ${urgencyIcon} ${
                                marker.urgency === 'low' ? 'å»ºè®®æ”¹è¿›' : 
                                marker.urgency === 'medium' ? 'éœ€è¦å…³æ³¨' : 'ç´§æ€¥é—®é¢˜'
                            }
                        </div>
                        
                        <div class="marker-description">
                            ${marker.description.length > 100 ? 
                              marker.description.substring(0, 100) + '...' : 
                              marker.description}
                        </div>
                        
                        <div class="marker-footer">
                            <div>
                                <span style="margin-right: 10px;">
                                    <i class="fas fa-user"></i> ${marker.userName}
                                </span>
                                <span>
                                    <i class="fas fa-thumbs-up"></i> ${marker.votes}
                                </span>
                            </div>
                            <div class="marker-type ${'type-' + marker.problemType}">
                                ${marker.problemType === 'dormitory' ? 'å®¿èˆ' : 
                                  marker.problemType === 'canteen' ? 'é£Ÿå ‚' :
                                  marker.problemType === 'facilities' ? 'è®¾æ–½' :
                                  marker.problemType === 'sanitation' ? 'å«ç”Ÿ' :
                                  marker.problemType === 'security' ? 'å®‰å…¨' :
                                  marker.problemType === 'water' ? 'æ°´ç”µ' :
                                  marker.problemType === 'repair' ? 'ç»´ä¿®' : 'å…¶ä»–'}
                            </div>
                        </div>
                    `;
                    
                    // ç‚¹å‡»äº‹ä»¶
                    markerItem.addEventListener('click', function() {
                        showMarkerDetails(marker);
                    });
                    
                    markersList.appendChild(markerItem);
                });
            }
            
            // ========================
            // æ•°æ®å­˜å‚¨
            // ========================
            
            function saveMarkersToLocal() {
                try {
                    // ä¿å­˜æ ‡è®°æ•°æ®
                    localStorage.setItem('zqu-logistics-markers', JSON.stringify(markers));
                    
                    // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                    const userName = localStorage.getItem('zqu-userName') || 'ç”¨æˆ·' + Math.floor(Math.random() * 10000);
                    localStorage.setItem('zqu-userName', userName);
                } catch (e) {
                    console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);
                    showNotification('ä¿å­˜å¤±è´¥ï¼Œå­˜å‚¨ç©ºé—´å¯èƒ½å·²æ»¡', 'error');
                }
            }
            
            function loadMarkersFromLocal() {
                try {
                    const savedMarkers = localStorage.getItem('zqu-logistics-markers');
                    if (savedMarkers) {
                        markers = JSON.parse(savedMarkers);
                        
                        // æ¸…é™¤æ—§æ ‡è®°
                        const oldMarkers = document.querySelectorAll('.map-marker');
                        oldMarkers.forEach(marker => marker.remove());
                        
                        // æ·»åŠ æ ‡è®°åˆ°åœ°å›¾
                        markers.forEach(marker => addMarkerToMap(marker));
                        
                        // æ›´æ–°åˆ—è¡¨å’Œç»Ÿè®¡
                        updateMarkersList();
                        
                        showNotification(`å·²åŠ è½½ ${markers.length} ä¸ªé—®é¢˜åé¦ˆ`, 'success');
                    }
                } catch (e) {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
                }
            }
            
            // ========================
            // è¾…åŠ©åŠŸèƒ½
            // ========================
            
            function showNotification(message, type = 'info') {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'warning' ? '#ffc107' : '#17a2b8'};
                    color: ${type === 'warning' ? '#212529' : 'white'};
                    border-radius: 8px;
                    z-index: 2000;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                    animation: slideIn 0.3s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    max-width: 400px;
                `;
                
                const icon = type === 'success' ? 'fa-check-circle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 
                            type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle';
                
                notification.innerHTML = `
                    <i class="fas ${icon}" style="font-size: 1.2rem;"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
                
                // æ·»åŠ CSSåŠ¨ç”»
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            function showHelp() {
                alert(`
è‚‡åº†å­¦é™¢åå‹¤æœåŠ¡å·¥ä½œåº§è°ˆä¼šåé¦ˆç³»ç»Ÿä½¿ç”¨è¯´æ˜

1. åŸºæœ¬æ“ä½œ
   - ç‚¹å‡»åœ°å›¾ä»»æ„ä½ç½®æ·»åŠ é—®é¢˜åé¦ˆ
   - ç‚¹å‡»å·²æœ‰æ ‡è®°æŸ¥çœ‹é—®é¢˜è¯¦æƒ…
   - åœ¨å³ä¾§åˆ—è¡¨æŸ¥çœ‹æ‰€æœ‰é—®é¢˜åé¦ˆ

2. é—®é¢˜åˆ†ç±»
   - å®¿èˆç®¡ç†ä¸æœåŠ¡ï¼šå®¿èˆè®¾æ–½ã€ç®¡ç†æœåŠ¡ç­‰
   - é£Ÿå ‚é¤é¥®æœåŠ¡ï¼šé¤é¥®è´¨é‡ã€å«ç”Ÿã€æœåŠ¡ç­‰
   - å…¬å…±è®¾æ–½ç»´æŠ¤ï¼šæ•™å­¦æ¥¼ã€å›¾ä¹¦é¦†ã€è¿åŠ¨åœºç­‰
   - æ ¡å›­ç¯å¢ƒå«ç”Ÿï¼šæ¸…æ´å«ç”Ÿã€åƒåœ¾å¤„ç†ç­‰
   - æ ¡å›­å®‰å…¨ä¿éšœï¼šå®‰ä¿æªæ–½ã€å®‰å…¨éšæ‚£ç­‰
   - æ°´ç”µä¾›åº”æœåŠ¡ï¼šä¾›æ°´ä¾›ç”µé—®é¢˜
   - ç»´ä¿®å“åº”æ•ˆç‡ï¼šç»´ä¿®æœåŠ¡åŠæ—¶æ€§
   - å…¶ä»–æ„è§å»ºè®®ï¼šå…¶ä»–åå‹¤ç›¸å…³é—®é¢˜

3. ç®¡ç†å‘˜åŠŸèƒ½ï¼ˆåå‹¤èŒå·¥ï¼‰
   - é€‰æ‹©"åå‹¤èŒå·¥"èº«ä»½åéœ€è¾“å…¥PINç ï¼š105105
   - å¯ä»¥åˆ é™¤é—®é¢˜åé¦ˆ
   - å¯ä»¥ç¼–è¾‘é—®é¢˜åé¦ˆå†…å®¹
   - å¯ä»¥åˆ é™¤ä¸å½“è¯„è®º
   - å¯ä»¥æŸ¥çœ‹åŒ¿åç”¨æˆ·çš„çœŸå®èº«ä»½
   - å¯ä»¥ä¿®æ”¹é—®é¢˜çŠ¶æ€
   - å¯ä»¥å¯¼å‡ºé—®é¢˜æ•°æ®

4. ç´§æ€¥ç¨‹åº¦
   - å»ºè®®æ”¹è¿›ï¼šéç´§æ€¥ï¼Œå¯çº³å…¥é•¿æœŸè§„åˆ’
   - éœ€è¦å…³æ³¨ï¼šçŸ­æœŸå†…åº”è§£å†³
   - ç´§æ€¥é—®é¢˜ï¼šéœ€ç«‹å³å¤„ç†

5. æ ‡è®°é¢œè‰²è¯´æ˜
   - å®¿èˆé—®é¢˜ï¼šè“è‰²æ ‡è®°
   - é£Ÿå ‚é—®é¢˜ï¼šç»¿è‰²æ ‡è®°
   - è®¾æ–½é—®é¢˜ï¼šé»„è‰²æ ‡è®°
   - å«ç”Ÿé—®é¢˜ï¼šçº¢è‰²æ ‡è®°
   - å®‰å…¨é—®é¢˜ï¼šç°è‰²æ ‡è®°
   - æ°´ç”µé—®é¢˜ï¼šé’è‰²æ ‡è®°
   - ç»´ä¿®é—®é¢˜ï¼šçº¢è‰²æ ‡è®°
   - å…¶ä»–é—®é¢˜ï¼šç°è‰²æ ‡è®°

6. åº§è°ˆä¼šå·¥ä½œæµç¨‹
   - æ¯ä½å‚ä¸è€…ç‹¬ç«‹ä½¿ç”¨æœ¬ç³»ç»Ÿ
   - å„è‡ªåœ¨åœ°å›¾ä¸Šæ ‡è®°é—®é¢˜
   - åº§è°ˆä¼šç»“æŸåç»Ÿä¸€æ±‡æ€»
   - ç”Ÿæˆåå‹¤é—®é¢˜åˆ†ææŠ¥å‘Š

ç®¡ç†å‘˜PINç ï¼š105105
å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼šåå‹¤ç®¡ç†å¤„ (19860503565)
                `);
            }
            
            // ========================
            // äº‹ä»¶ç›‘å¬å™¨
            // ========================
            
            closeModalButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    markerModal.style.display = 'none';
                    detailModal.style.display = 'none';
                    pinModal.style.display = 'none';
                    editModal.style.display = 'none';
                });
            });
            
            cancelMarkerBtn.addEventListener('click', function() {
                markerModal.style.display = 'none';
            });
            
            saveMarkerBtn.addEventListener('click', saveMarker);
            
            helpBtn.addEventListener('click', showHelp);
            
            // åˆ†ç±»ç­›é€‰
            categoryButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    categoryButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    updateMarkersList();
                });
            });
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(e) {
                if (e.target === markerModal) {
                    markerModal.style.display = 'none';
                }
                if (e.target === detailModal) {
                    detailModal.style.display = 'none';
                }
                if (e.target === pinModal) {
                    pinModal.style.display = 'none';
                    userDepartmentSelect.value = 'student'; // é‡ç½®ä¸ºé»˜è®¤å€¼
                }
                if (e.target === editModal) {
                    editModal.style.display = 'none';
                }
            });
            
            // ========================
            // åˆå§‹åŒ–
            // ========================
            
            initMap();
        });
    </script>
</body>
</html>